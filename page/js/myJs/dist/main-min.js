function ImpostaBreadCrumb(e,t){var a,n=new Array(e);0==e&&(localStorage.removeItem("breadcrumb"),console.log("canellata breadcrumb")),null===localStorage.getItem("breadcrumb")?(a={desc:"WebOasi Home",url:"#"},n.push(a),a={desc:"Dashboard User",url:"#"},n.push(a),localStorage.setItem("breadcrumb",JSON.stringify(n)),t="Dashboard User"):(a={desc:t,url:"#"},(n=JSON.parse(localStorage.getItem("breadcrumb")))[e]=a,localStorage.setItem("breadcrumb",JSON.stringify(n)),console.log(n)),RefreshBreadCrumb(t)}function RefreshBreadCrumb(e){var t=new Array;if(null!==localStorage.getItem("breadcrumb")){var a;t=JSON.parse(localStorage.getItem("breadcrumb")),console.log("*************************************************************"),console.log(t),a="";for(let n in t)e==t[n].desc?a+='  <li class="breadcrumb-item active"><a href="'+t[n].url+';">'+t[n].desc+"</a></li> \n":a+='  <li class="breadcrumb-item"><a href="'+t[n].url+';">'+t[n].desc+"</a></li> \n";a+='  <li class="position-absolute pos-center pos-left d-none d-sm-block"><br> \n',a+='  <div id="ph-get-date" style="color:#a6a4a6" >'+GetDateString()+"</div></li> \n",console.log(a),document.getElementById("ph-breadcrumb").innerHTML=a}}function LoadCalendar(e,t){var a,n,o,s=new Date,i=localStorage.getItem("jwt");a=e||new Date(s.getFullYear(),s.getMonth(),1),n=t||new Date(s.getFullYear(),s.getMonth()+1,0);var r=JSON.stringify({jwt:i,dbschema:"Scadenze",dtInizio:GetDateFormat(a),dtFine:GetDateFormat(n)});$.ajax({type:"POST",url:cg_BaseUrl+"/api/eventi/read.php",async:!0,data:r,dataType:"json",success:function(e){let t,a,n=e;localStorage.setItem("jwt",n.jwt),o=n.eventi;var s=[];for(t in o)for(a in o[t].elnEventiDet){let e={ID:o[t].elnEventiDet[a].idRow,idEvento:o[t].idEvento,title:o[t].evento,evento_esteso:o[t].evento_esteso,start:o[t].elnEventiDet[a].dataOccorrenza,description:o[t].evento_esteso,className:o[t].classCSS};s.push(e)}var i=document.getElementById("calendar"),r=new FullCalendar.Calendar(i,{plugins:["dayGrid","list","timeGrid","interaction","bootstrap"],themeSystem:"bootstrap",timeZone:"UTC",dateAlignment:"month",buttonText:{today:"Oggi",month:"Mensile",week:"Settimanale",day:"Giornaliera",list:"lista"},eventTimeFormat:{hour:"numeric",minute:"2-digit",meridiem:"short"},navLinks:!0,header:{left:"prev,next today addEventButton",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},footer:{left:"",center:"",right:""},eventClick:function(e){let t=e.event.extendedProps.idEvento;document.getElementById("lblTitleModalScadenze").innerHTML='Modifica evento... \n<small class="m-0 text-danger"> \nAttenzione, modificando la ricorrenza si perderennao tutte le future scadenze!\n</small>',document.getElementById("txtScEventoTitolo").value=e.event.title,document.getElementById("txtScEventoDesc").value=e.event.extendedProps.evento_esteso,LoadDatatables("tableDipendentiViewer",{idEvento:t}),$("#modalEvento").modal({backdrop:!1})},customButtons:{addEventButton:{text:"+",click:function(){document.getElementById("lblTitleModalScadenze").innerHTML='Aggiungi evento... \n<small class="m-0 text-muted"> \nper aggiungere una ricorrenza, cliccare su "RICORRENZA" \n</small>',document.getElementById("txtScEventoTitolo").value="",document.getElementById("txtScEventoDesc").value="",LoadDatatables("tableDipendentiViewer",{idEvento:"1"}),$("#modalEvento").modal({backdrop:!1})}}},editable:!0,eventLimit:!0,events:s,viewSkeletonRender:function(){$(".fc-toolbar .btn-default").addClass("btn-sm"),$(".fc-header-toolbar h2").addClass("fs-md"),$("#calendar").addClass("fc-reset-order")}});r.on("dateClick",function(e){console.log("clicked on "+e.dateStr)}),r.render()},error:function(e){var t=JSON.parse(e.responseText),a=msgAlert(t.error,t.message);document.getElementById("response").innerHTML=a}})}const cg_MinCheckSession=30,cg_milliSecControlloSessione=5e4,cg_BaseUrl="http://10.0.2.44:8080/WebOasi",cg_PathImg=cg_BaseUrl+"/page/img";function LoadDatatables(e,t){null===localStorage.getItem("jwt")&&window.location.replace(cg_BaseUrl+"/page/page-login.php");var a=localStorage.getItem("jwt"),n={};switch(t&&(n=t),n.jwt=a,console.log(n),n=JSON.stringify(n),e){case"tableDipendentiViewer":LoadDtbDipendentiViewver(e,n);break;case"tableOspitiParametri":LoadDtbOspitiParametri(e,n)}}function LoadDtbDipendentiViewver(e,t){var a,n;$("#"+e).on("click","tbody td",function(){var e=n.cell(this).index(),t=n.row(this).data(),a=e.column;switch(n.column(a).header().textContent){case"Mod.":alert("MODIFICA"),t.NOME_UTENTE="Luke";break;case"Canc.":alert("elimina")}}),$.ajax({type:"POST",url:cg_BaseUrl+"//api//users//readEventViewer.php",async:!0,data:t,dataType:"json",success:function(t,o,s){let i=t;switch(s.status){case 200:localStorage.setItem("jwt",i.jwt),a=i.eventi,n=$("#"+e).DataTable({destroy:!0,responsive:!0,data:a,dataSrc:"eventi",selectType:"cell",columns:[{data:"idRow",title:"idRow",visible:!1},{data:"idEvento",title:"idEvento",visible:!1},{data:"idUser",title:"idUser",visible:!1},{data:"IMG",title:"Immagine",visible:!0},{data:"NOME_UTENTE",title:"Dipendente",visible:!0},{data:"flagVis",title:"Visualizza",visible:!0},{data:"flagMod",title:"Modifica",visible:!0},{data:"flagDel",title:"Cancella",visible:!0},{data:"flagPrint",title:"Stampa",visible:!0},{data:"UTENTE",title:"Utente",visible:!1},{data:"MODIFICA",title:"Mod.",visible:!0},{data:"ELIMINA",title:"Canc.",visible:!0}],columnDefs:[{targets:10,data:"img",render:function(e,t,a){return"display"===t?'<a href="#"><img src="'+cg_PathImg+'/ico/p24x24_Edit.png" width="24px" height="24px"></a>':e+"ciao"}},{targets:11,data:"img",render:function(e,t,a){return"display"===t?'<a href="#"><img src="'+cg_PathImg+'/ico/p24x24_EliminaV2.png" width="24px" height="24px"></a>':e+"ciao"}},{targets:3,data:"img",render:function(e,t,a){return"display"===t&&e.length>2?'<img src="'+e+'" id="imgDip24x24" width="24" height="24" class="profile-image rounded-circle mx-auto d-block">':e+"ciao"}},{targets:[5,6,7,8],render:function(e,t){return"display"===t?1==e?'<i class="fal fa-check-circle text-success"></i>':'<i class="fal fa-circle text-warning"></i>':e}}],dom:"\"<'row mb-3'<'col-sm-12 col-md-6 d-flex align-items-center justify-content-start'f><'col-sm-12 col-md-6 d-flex align-items-center justify-content-end'B>>\" +\n                        \"<'row'<'col-sm-12'tr>>\" +\n                        \"<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>\"",buttons:[{text:"Agg. Utente",className:"btn btn-outline-success",action:function(e,t,a,n){alert("Button activated")}}]});break;case 401:console.log(data);case 500:console.log(data);default:var r=msgAlert(i.message_title,i.message_body);document.getElementById("response").innerHTML=r,window.location.replace(cg_BaseUrl+"/page/page-login.php")}},error:function(e,t){var a="";console.log(e.responseText);var n=JSON.parse(e.responseText);a=0===e.status?"Not connect.\n Verify Network.":401==e.status?"Da rest api: "+n.message_body+" \n":404==e.status?"Requested page not found. [404]":500==e.status?"Internal Server Error [500].":"parsererror"===t?"Requested JSON parse failed.":"timeout"===t?"Time out error.":"abort"===t?"Ajax request aborted.":"Uncaught Error.\n"+n.message_body,""!==n.message_system&&(document.getElementById("message_system").innerHTML="<strong>"+n.message_system+"</strong>");var o=msgAlert(n.message_title,a);document.getElementById("response").innerHTML=o}})}function LoadDtbOspitiParametri(e,t){var a,n;$("#"+e).on("click","tbody td",function(){var e=n.cell(this).index(),t=n.row(this).data();e.column;if(a.map(function(e){return e.ID_OSPITE}).indexOf(t.ID_OSPITE)>-1){let e='<h4 class="modal-title" id="lblTitleModalParametri"> \n     Inserimento parametri per '+t.OSPITE+'\n     <small class="m-0 text-muted" > \n      Ultimi parametri rilevati: Oggi, alle 9:30 \n     </small> \n</h4>';document.getElementById("lblTitleModalParametri").innerHTML=e,$("#modalSchIsolamento").modal({backdrop:!1})}else{var o=msgAlert("Ospite non trovato!","Manca nelle elenco Ospiti Paramatri ");$("#response").show(),document.getElementById("response").innerHTML=o,setTimeout(function(){$("#response").hide()},1e4)}}),$.ajax({type:"POST",url:cg_BaseUrl+"/api/Ospiti/readOspitiParametri.php",async:!0,data:t,dataType:"json",success:function(t,o,s){let i=t;switch(s.status){case 200:localStorage.setItem("jwt",i.jwt),a=i.ElnOspitiParametri,n=$("#"+e).DataTable({destroy:!0,responsive:!0,data:a,dataSrc:"ElnOspitiParametri",selectType:"row",columns:[{data:"ID_OSPITE",title:"ID_OSPITE",visible:!1},{data:"OSPITE",title:"Ospite",visible:!0},{data:"NUM_LETTO",title:"Letto",visible:!1},{data:"NUM_CAMERA",title:"Camera",visible:!0},{data:"PIANO",title:"Piano",visible:!0},{data:"SEZIONE",title:"Sezione",visible:!0}],dom:"\"<'row mb-3'<'col-sm-12 col-md-6 d-flex align-items-center justify-content-start'f><'col-sm-12 col-md-6 d-flex align-items-center justify-content-end'B>>\" +\n                        \"<'row'<'col-sm-12'tr>>\" +\n                        \"<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>\"",buttons:[{text:"Agg. Utente",className:"btn btn-outline-success",action:function(e,t,a,n){alert("Button activated")}}]});break;case 401:console.log(data);case 500:console.log(data);default:var r=msgAlert(i.message_title,i.message_body);document.getElementById("response").innerHTML=r,window.location.replace(cg_BaseUrl+"/page/page-login.php")}},error:function(e,t){var a="";console.log(e.responseText);var n=JSON.parse(e.responseText);a=0===e.status?"Not connect.\n Verify Network.":401==e.status?"Da rest api: "+n.message_body+" \n":404==e.status?"Requested page not found. [404]":500==e.status?"Internal Server Error [500].":"parsererror"===t?"Requested JSON parse failed.":"timeout"===t?"Time out error.":"abort"===t?"Ajax request aborted.":"Uncaught Error.\n"+n.message_body,""!==n.message_system&&(document.getElementById("message_system").innerHTML="<strong>"+n.message_system+"</strong>");var o=msgAlert(n.message_title,a);document.getElementById("response").innerHTML=o}})}function OnClickbtnLogout(){$("#ph-btnLogout").click(function(e){localStorage.removeItem("jwt"),window.location.replace(cg_BaseUrl+"/page/page-login.php")})}function OnClicMenuPrimary(e){let t=e.name;ajaxpage(cg_BaseUrl+"/page/view/"+t+".tpl.php","ph-main",t)}function OnSubmitAjaxLogin(){$("#login_form").submit(function(e){var t=document.getElementById("txtUtente").value,a=document.getElementById("txtPass").value,n=document.getElementById("idStruttura").value,o=JSON.stringify({username:t,password:a,idStruttura:n});return $.ajax({type:"POST",url:"../api/login.php",data:o,context:document.body,async:!0,datatype:"json",success:function(e,t){try{console.log("ajax ok but: "+e),console.log(e);let t=e;""!==t.message_system&&(document.getElementById("message_system").innerHTML="<strong>"+t.message_system+"</strong>");var a=msgSuccess(t.message_title,t.message_body);document.getElementById("response").innerHTML=a,localStorage.setItem("jwt",t.jwt);var n={};n.jwt=t.jwt,n=JSON.stringify(n),$.redirectPost("page-home.php",JSON.parse(n))}catch(e){console.log(e),alert("Erroe ajax try"+e)}},error:function(e,t){var a="";console.log(e.responseText);var n=JSON.parse(e.responseText);a=0===e.status?"Not connect.\n Verify Network.":401==e.status?"Da rest api: "+n.message_body+" \n":404==e.status?"Requested page not found. [404]":500==e.status?"Internal Server Error [500].":"parsererror"===t?"Requested JSON parse failed.":"timeout"===t?"Time out error.":"abort"===t?"Ajax request aborted.":"Uncaught Error.\n"+n.message_body,""!==n.message_system&&(document.getElementById("message_system").innerHTML="<strong>"+n.message_system+"</strong>");var o=alertMsg(n.message_title,a);document.getElementById("response").innerHTML=o}}),e.preventDefault(),!1})}function OnClickSelStruttura(){$(".btn-primary").click(function(e){let t=document.getElementById("idStruttura");this.value>-1?t.value=this.value:t.value=-1})}function OnClickbtnSaveOspitiParametri(){$("#btnSaveOspitiParametri").click(function(e){let t,a=$("#txtTemperatura"),n=$("#txtSaturazione"),o=$("#txtOssigeno");""!=a.val()?(a.removeClass("is-invalid"),a.last().addClass("is-valid"),t=n.val(),t=Number(t),isNaN(t)||""==n.val()?n.last().addClass("is-invalid"):(n.removeClass("is-invalid"),n.last().addClass("is-valid"),t=o.val(),t=Number(t),isNaN(t)||""==o.val()?o.last().addClass("is-invalid"):(o.removeClass("is-invalid"),o.last().addClass("is-valid"),$("#modalSchIsolamento").modal("hide")))):a.last().addClass("is-invalid")})}function GetDateFormat(e){var t,a,n;return a=(t=e||new Date).getDate(),n=t.getMonth()+1,t.getFullYear()+"-"+n+"-"+a}function GetDateString(){var e,t,a,n,o=new Date,s=new Array;s[0]="Gennaio",s[1]="Febbraio",s[2]="Marzo",s[3]="Aprile",s[4]="Maggio",s[5]="Giugno",s[6]="Luglio",s[7]="Agosto",s[8]="Settembre",s[9]="Ottobre",s[10]="Novembre",s[11]="Dicembre";var i=new Array;return i[0]="Domenica",i[1]="Lunedì",i[2]="Martedì",i[3]="Mercoledì",i[4]="Giovedì",i[5]="Venerdì",i[6]="Sabato",e=i[o.getDay()]+" ",t=o.getDate()+" ",a=s[o.getMonth()]+" ",n=o.getFullYear()+" ",o.getHours()+":",o.getMinutes()+":",o.getSeconds(),"Oggi è "+e+t+a+n}function msgAlert(e,t){return'<div class="alert border-danger bg-transparent text-secondary fade show" role="alert">\n   <div class="d-flex align-items-center"> \n       <div class="alert-icon"> \n           <span class="icon-stack icon-stack-md"> \n               <i class="base-7 icon-stack-3x color-danger-900"></i> \n               <i class="fal fa-times icon-stack-1x text-white"></i> \n           </span> \n       </div> \n       <div class="flex-1"> \n            <span class="h5 color-danger-900">'+e+"</span> \n           <br> \n          "+t+" \n       </div> \n   </div> \n</div> \n"}function msgSuccess(e,t){return'<div class="alert border-faded bg-transparent text-secondary fade show" role="alert">\n   <div class="d-flex align-items-center"> \n       <div class="alert-icon"> \n           <span class="icon-stack icon-stack-md"> \n               <i class="base-7 icon-stack-3x color-success-600"></i> \n               <i class="fal fa-check icon-stack-1x text-white"></i> \n           </span> \n       </div> \n       <div class="flex-1"> \n            <span class="h5 color-success-600">'+e+"</span> \n           <br> \n          "+t+" \n       </div> \n   </div> \n</div> \n"}$.extend({redirectPost:function(e,t){var a="";$.each(t,function(e,t){t=t.split('"').join('"'),a+='<input type="hidden" name="'+e+'" value="'+t+'">'}),$('<form action="'+e+'" method="POST">'+a+"</form>").appendTo($(document.body)).submit()}}),$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e};var loadedobjects="",rootdomain=cg_BaseUrl;function ajaxpage(e,t,a){var n=localStorage.getItem("jwt"),o=!1;if(window.XMLHttpRequest)o=new XMLHttpRequest;else{if(!window.ActiveXObject)return!1;try{o=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{o=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}o.onreadystatechange=function(){loadpage(o,t,a)},o.open("POST",e,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send("jwt="+n)}function loadpage(e,t,a){if(4==e.readyState&&(200==e.status||-1==window.location.href.indexOf("http")))switch(document.getElementById(t).innerHTML=e.responseText,a.toUpperCase()){case"MAIN":ImpostaBreadCrumb(0,"WebOasi Home"),LoadCalendar();break;case"SCADENZE":ImpostaBreadCrumb(2,"Scadenze"),LoadCalendar();break;case"SCHISOLAMENTO":ImpostaBreadCrumb(2,"Scheda Isolamento"),LoadDatatables("tableOspitiParametri",{idEvento:"1"}),OnClickbtnSaveOspitiParametri();break;default:var n=msgAlert("Errore Pagina Ajax","Status: "+e.status);$("#response").show(),document.getElementById("response").innerHTML=n,setTimeout(function(){$("#response").hide()},1e4),ajaxpage(cg_BaseUrl+"/page/view/main.tpl.php","ph-main")}}function loadobjs(){if(document.getElementById)for(i=0;i<arguments.length;i++){var e=arguments[i],t="";-1==loadedobjects.indexOf(e)&&(-1!=e.indexOf(".js")?((t=document.createElement("script")).setAttribute("type","text/javascript"),t.setAttribute("src",e)):-1!=e.indexOf(".css")&&((t=document.createElement("link")).setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e))),""!=t&&(document.getElementsByTagName("head").item(0).appendChild(t),loadedobjects+=e+" ")}}switch(!0){case-1!=self.location.href.indexOf("page-login"):window.onload=function(){OnSubmitAjaxLogin(),OnClickSelStruttura()};break;case-1!=self.location.href.indexOf("page-home"):window.onload=function(){Ping(1800),Display("ph-primary_nav","primary_nav"),ajaxpage(cg_BaseUrl+"/page/view/main.tpl.php","ph-main","main"),OnClickbtnLogout()},window.onunload=function(){};break;default:alert("Route non gestita!")}function Ping(e){null===localStorage.getItem("jwt")&&window.location.replace(cg_BaseUrl+"/page/page-login.php");var t,a,n=e,o=setInterval(function(){t=parseInt(n/60,10),a=parseInt(n%60,10),t=t<10?"0"+t:t,a=a<10?"0"+a:a,console.log("Controllo sessione: "+t+":"+a),--n;var e=location.protocol.toString()+"//"+location.hostname.toString(),s=localStorage.getItem("jwt"),i={};if(i.jwt=s,i=JSON.stringify(i),-1===e.indexOf("WebOasi")&&-1===e.indexOf("oasionlus.com")&&-1===e.indexOf("localhost")&&-1===e.indexOf("10.0.2.44"))return!0;-1!=e.indexOf("localhost")&&(e=cg_BaseUrl),""==s&&(clearInterval(o),window.location.replace(cg_BaseUrl+"/page/page-login.php")),$.ajax({type:"POST",url:cg_BaseUrl+"/api/validate_token.php",async:!0,data:i,dataType:"json",success:function(e,t,a){switch(a.status){case 200:console.log(e);break;case 401:console.log(e),alert("dentro if prima del redirect ");case 500:console.log(e);default:console.log(e),clearInterval(o),window.location.replace(cg_BaseUrl+"/page/page-login.php")}},error:function(e){console.log(e),clearInterval(o),window.location.replace(cg_BaseUrl+"/page/page-login.php")}})},cg_milliSecControlloSessione)}function Display(e,t,a){null===localStorage.getItem("jwt")&&window.location.replace(cg_BaseUrl+"/page/page-login.php");var n=localStorage.getItem("jwt"),o={};o.jwt=n,o=JSON.stringify(o),""===n&&window.location.replace(cg_BaseUrl+"/page/page-login.php");var s=document.getElementById(e),i=document.createElement("img"),r=document.createAttribute("src"),l=document.createAttribute("id"),c=document.createAttribute("class");r.value="img/ajax-loader.gif",l.value="wait",c.value="align-self: center, position: relative",i.setAttributeNode(r),i.setAttributeNode(l),i.setAttributeNode(c),s.appendChild(i),$.ajax({type:"POST",url:cg_BaseUrl+"/page/view/"+t+".tpl.php",async:!0,data:o,dataType:"html",beforeSend:function(){$("#wait").show()},success:function(t,a,n){switch(console.log(n),n.status){case 200:console.log(t),document.getElementById(e).innerHTML=t;break;case 401:console.log(t),alert("dentro if prima del redirect ");case 500:console.log(t);default:console.log(t),window.location.replace(cg_BaseUrl+"/page/page-login.php")}},error:function(e){alert("error ajax Display (javascript)"),console.log(e),window.location.replace(cg_BaseUrl+"/page/page-login.php")},complete:function(){$("#wait").hide()}})}